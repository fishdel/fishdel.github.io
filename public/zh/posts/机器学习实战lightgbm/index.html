<!DOCTYPE html>
<html lang="zh" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM) | Yuuuuu&#39;s Blog</title>
<meta name="keywords" content="Machine learning">
<meta name="description" content="LightGBM
ä»‹ç»
LightGBMï¼ˆLight Gradient Boosting Machineï¼‰ï¼šä¸€ä¸ªå®ç°GBDTç®—æ³•çš„æ¡†æ¶ï¼Œè§£å†³GBDTåœ¨æµ·é‡æ•°æ®é‡åˆ°çš„é—®é¢˜ã€‚
ä¸¤å¤§æŠ€æœ¯ï¼š
ï¼ˆ1ï¼‰GOSS(Gradient-based One-Side Sampling)ï¼šå‡å°‘æ ·æœ¬æ•°">
<meta name="author" content="">
<link rel="canonical" href="https://fishdel.github.io/zh/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98lightgbm/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css" integrity="sha256-1vzSCk&#43;4bvpN&#43;sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as="style">
<link rel="icon" href="https://fishdel.github.io/favicon.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://fishdel.github.io/favicon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://fishdel.github.io/favicon.png">
<link rel="apple-touch-icon" href="https://fishdel.github.io/favicon.png">
<link rel="mask-icon" href="https://fishdel.github.io/favicon.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<link rel="alternate" hreflang="zh" href="https://fishdel.github.io/zh/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98lightgbm/">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --code-block-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript><meta property="og:url" content="https://fishdel.github.io/zh/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98lightgbm/">
  <meta property="og:site_name" content="Yuuuuu&#39;s Blog">
  <meta property="og:title" content="æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM)">
  <meta property="og:description" content="LightGBM ä»‹ç» LightGBMï¼ˆLight Gradient Boosting Machineï¼‰ï¼šä¸€ä¸ªå®ç°GBDTç®—æ³•çš„æ¡†æ¶ï¼Œè§£å†³GBDTåœ¨æµ·é‡æ•°æ®é‡åˆ°çš„é—®é¢˜ã€‚
ä¸¤å¤§æŠ€æœ¯ï¼š ï¼ˆ1ï¼‰GOSS(Gradient-based One-Side Sampling)ï¼šå‡å°‘æ ·æœ¬æ•°">
  <meta property="og:locale" content="zh">
  <meta property="og:type" content="article">
    <meta property="article:section" content="posts">
    <meta property="article:published_time" content="2022-04-05T22:11:08+08:00">
    <meta property="article:modified_time" content="2022-04-05T22:11:08+08:00">
    <meta property="article:tag" content="Machine Learning">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM)">
<meta name="twitter:description" content="LightGBM
ä»‹ç»
LightGBMï¼ˆLight Gradient Boosting Machineï¼‰ï¼šä¸€ä¸ªå®ç°GBDTç®—æ³•çš„æ¡†æ¶ï¼Œè§£å†³GBDTåœ¨æµ·é‡æ•°æ®é‡åˆ°çš„é—®é¢˜ã€‚
ä¸¤å¤§æŠ€æœ¯ï¼š
ï¼ˆ1ï¼‰GOSS(Gradient-based One-Side Sampling)ï¼šå‡å°‘æ ·æœ¬æ•°">


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Posts",
      "item": "https://fishdel.github.io/zh/posts/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM)",
      "item": "https://fishdel.github.io/zh/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98lightgbm/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM)",
  "name": "æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM)",
  "description": "LightGBM ä»‹ç» LightGBMï¼ˆLight Gradient Boosting Machineï¼‰ï¼šä¸€ä¸ªå®ç°GBDTç®—æ³•çš„æ¡†æ¶ï¼Œè§£å†³GBDTåœ¨æµ·é‡æ•°æ®é‡åˆ°çš„é—®é¢˜ã€‚\nä¸¤å¤§æŠ€æœ¯ï¼š ï¼ˆ1ï¼‰GOSS(Gradient-based One-Side Sampling)ï¼šå‡å°‘æ ·æœ¬æ•°\n",
  "keywords": [
    "Machine learning"
  ],
  "articleBody": "LightGBM ä»‹ç» LightGBMï¼ˆLight Gradient Boosting Machineï¼‰ï¼šä¸€ä¸ªå®ç°GBDTç®—æ³•çš„æ¡†æ¶ï¼Œè§£å†³GBDTåœ¨æµ·é‡æ•°æ®é‡åˆ°çš„é—®é¢˜ã€‚\nä¸¤å¤§æŠ€æœ¯ï¼š ï¼ˆ1ï¼‰GOSS(Gradient-based One-Side Sampling)ï¼šå‡å°‘æ ·æœ¬æ•°\nï¼ˆ2ï¼‰EFB (Exclusive Feature Bundling ):å‡å°‘ç‰¹å¾æ•°\nXGBoostçš„ç¼ºç‚¹ï¼šå…ˆé¢„æ’åºå†æ‰¾åˆ†å‰²ç‚¹ï¼Œç©ºé—´æ¶ˆè€—å¤§\nXGBoostä¸LightGBMçš„åŒºåˆ«ï¼š\nlightGBM XGBoost åˆ†è£‚æ–¹å¼ leaft-wiseé€‰æ‹©åˆ†è£‚æ”¶ç›Šæœ€å¤§çš„èŠ‚ç‚¹ï¼Œè¦é™åˆ¶æ·±åº¦å®¹æ˜“è¿‡æ‹Ÿåˆ level-wiseæ— å·®åˆ«åˆ†è£‚ è¾“å…¥ lightgbmæ”¯æŒç›´æ¥è¾“å…¥categorical çš„feature éœ€è¦one-hotç¼–ç  æ—¶é—´å¤æ‚åº¦ åŸºäºç›´æ–¹å›¾çš„å†³ç­–æ ‘ç®—æ³•ï¼Œç›´æ–¹å›¾çš„ä¼˜åŒ–ç®—æ³•åªéœ€è¦è®¡ç®—Kæ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(Kfeature) åŸºäºé¢„æ’åºçš„å†³ç­–æ ‘ç®—æ³•ï¼Œæ¯éå†ä¸€ä¸ªç‰¹å¾å°±éœ€è¦è®¡ç®—ä¸€æ¬¡ç‰¹å¾çš„å¢ç›Šï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(datafeature) ç‰¹å¾æ†ç»‘è½¬åŒ–ä¸ºå›¾ç€è‰²é—®é¢˜ï¼Œå‡å°‘ç‰¹å¾æ•°é‡ ä¸¤ç§ä½¿ç”¨å½¢å¼ sklearnæ¥å£å½¢å¼ å¯¼åŒ…\nimport lightgbm as lgb from sklearn.metrics import mean_squared_error from sklearn.datasets import load_boston from sklearn.model_selection import train_test_split gbm = lgb.LGBMRegressor(objective='regression', num_leaves=31, learning_rate=0.05, n_estimators=20) gbm.fit(X_train, y_train, eval_set=[(X_test, y_test)], eval_metric='l1', early_stopping_rounds=5) åŸç”Ÿå½¢å¼ æ•°æ®é›†åˆ‡åˆ†ä¸è½¬æ¢\nlgb_train = lgb.Dataset(X_train, y_train) #If this is Dataset for validation, training data should be used as reference. lgb_eval = lgb.Dataset(X_test, y_test, reference=lgb_train) å°†å‚æ•°å†™ä¸ºå­—å…¸å½¢å¼\nparams = { 'task': 'train', 'boosting_type': 'gbdt', # è®¾ç½®æå‡ç±»å‹ 'objective': 'regression', # ç›®æ ‡å‡½æ•° 'metric': {'l2', 'auc'}, # è¯„ä¼°å‡½æ•° 'num_leaves': 31, # å¶å­èŠ‚ç‚¹æ•° 'learning_rate': 0.05, # å­¦ä¹ é€Ÿç‡ 'feature_fraction': 0.9, # å»ºæ ‘çš„ç‰¹å¾é€‰æ‹©æ¯”ä¾‹ 'bagging_fraction': 0.8, # å»ºæ ‘çš„æ ·æœ¬é‡‡æ ·æ¯”ä¾‹ 'bagging_freq': 5, # k æ„å‘³ç€æ¯ k æ¬¡è¿­ä»£æ‰§è¡Œbagging 'verbose': 1 # \u003c0 æ˜¾ç¤ºè‡´å‘½çš„, =0 æ˜¾ç¤ºé”™è¯¯ (è­¦å‘Š), \u003e0 æ˜¾ç¤ºä¿¡æ¯ } äº¤å‰éªŒè¯ä¸é¢„æµ‹è¯„ä¼°\ngbm = lgb.train(params, lgb_train, num_boost_round=20, valid_sets=lgb_eval, early_stopping_rounds=5) y_pred = gbm.predict(X_test, num_iteration=gbm.best_iteration) Epochã€Iterationã€Batchsizeç›¸å…³ç†è§£ Epoch ä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†é€šè¿‡äº†ç¥ç»ç½‘ç»œä¸€æ¬¡å¹¶ä¸”è¿”å›äº†ä¸€æ¬¡ã€‚æ¢¯åº¦ä¸‹é™çš„æ–¹æ³•æ¥ä¼˜åŒ–å­¦ä¹ è¿‡ç¨‹ï¼Œéšç€epoch\nIteration batchéœ€è¦å®Œæˆä¸€ä¸ªepochçš„æ¬¡æ•°\nä¸€ä¸ªè¿­ä»£=ä¸€ä¸ªæ­£å‘é€šè¿‡+ä¸€ä¸ªåå‘é€šè¿‡ã€‚\nBatchsize ä¸èƒ½å°†æ•°æ®ä¸€æ¬¡æ€§é€šè¿‡ç¥ç»ç½‘ç»œçš„æ—¶å€™ï¼Œå°±éœ€è¦å°†æ•°æ®é›†åˆ†æˆå‡ ä¸ªbatchã€‚\nbatchsizeçš„é€‰æ‹©ï¼šBatchï¼šæ•°æ®é›†è¾ƒå°é€‰æ‹©å…¨æ‰¹æ¬¡\nmini batchï¼šé€‰å®šåä»¥batchçš„å¤§å°è¾“å…¥ç½‘ç»œï¼Œè®¡ç®—è¿™ä¸ªbatchçš„æ‰€æœ‰æ ·æœ¬çš„å¹³å‡æŸå¤±ï¼Œå³ä»£ä»·å‡½æ•°æ˜¯æ‰€æœ‰æ ·æœ¬çš„å¹³å‡\nstochasticï¼šæ¯æ¬¡ä¿®æ­£æ–¹å‘ä»¥å„è‡ªæ ·æœ¬çš„æ¢¯åº¦æ–¹å‘ä¿®æ­£ï¼Œéš¾æ”¶æ•›\nå¦‚æœbatchsizeè¿‡å°ï¼Œè®­ç»ƒæ•°æ®éš¾ä»¥æ”¶æ•›å®¹æ˜“æ¬ æ‹Ÿåˆï¼Œå¢åŠ batchsizeç›¸å¯¹å¤„ç†é€Ÿåº¦åŠ å¿«ä½†æ˜¯å ç”¨å†…å­˜å¢åŠ \nå‚æ•°è°ƒæ•´ é¢„å…ˆå›ºå®šçš„å‚æ•° è°ƒæ•´ç­–ç•¥ learning_rate 0.05~0.1 å­¦ä¹ ç‡è¾ƒå°æ¯”è¾ƒç¨³å®šã€‚é»˜è®¤0.1 n_estimators 100~1000ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„å€¼é…åˆearly_stopping_roundæ¥è®©æ¨¡å‹æ ¹æ®æ€§èƒ½è‡ªåŠ¨é€‰æ‹©æœ€å¥½çš„è¿­ä»£æ¬¡æ•°ã€‚é»˜è®¤100 min_split_gain æ‰§è¡ŒèŠ‚ç‚¹åˆ†è£‚çš„æœ€å°å¢ç›Šã€‚é»˜è®¤ä¸º0ã€‚ä¸å»ºè®®å»è°ƒæ•´ã€‚å¢å¤§è¿™ä¸ªæ•°å€¼ä¼šå¾—åˆ°ç›¸å¯¹æµ…çš„æ ‘æ·±ã€‚å¯è°ƒæ•´å…¶ä»–å‚æ•°å¾—åˆ°ç±»ä¼¼æ•ˆæœã€‚ min_child_sample ä¸€ä¸ªå¶å­ä¸Šçš„æœ€å°æ•°æ®é‡ã€‚é»˜è®¤è®¾ç½®ä¸º20.æ•°æ®é‡å¤§é€‚å½“å¢åŠ  min_child_weight ä¸€ä¸ªå¶å­ä¸Šçš„æœ€å°hessianå’Œã€‚é»˜è®¤è®¾ç½®ä¸º0.001ï¼Œä¸€èˆ¬è®¾ç½®ä¸º1ã€‚ä¸å»ºè®®è°ƒæ•´ï¼Œå¢å¤§æ•°å€¼ä¼šå¾—åˆ°è¾ƒæµ…çš„æ ‘æ·± é€šè¿‡ç®—æ³•æ¥æœç´¢çš„å‚æ•° è°ƒæ•´ç­–ç•¥ max_depth 3ï¼Œ4ï¼Œ5ï¼ˆè¿‡å¤§å®¹æ˜“è¿‡æ‹Ÿåˆï¼‰ num_leaves å°äº2^max_depth-1 subsample å¤§è‡´çš„æœç´¢èŒƒå›´[0.8, 0.9, 1.0] colsample_bytree å¤§è‡´çš„æœç´¢èŒƒå›´[0.8, 0.9, 1.0] reg_alpha æœåŠ¡äºL1æ­£åˆ™åŒ–ï¼Œä¸€èˆ¬å–0-1000çš„èŒƒå›´ã€‚é€šè¿‡ç‰¹å¾ç­›é€‰è¯¥æ•°å€¼ç”±å¤§å˜å°å¯ä»¥å¢åŠ æ¨¡å‹ä¿¡å¿ƒ reg_lambda æœåŠ¡äºL2æ­£åˆ™åŒ–ï¼Œä¸€èˆ¬0-1000çš„èŒƒå›´ã€‚å¦‚æœæœ‰éå¸¸å¼ºåŠ¿çš„ç‰¹å¾ï¼Œå¯ä»¥äººä¸ºåŠ å¤§ä¸€äº›reg_lambdaä½¿å¾—æ•´ä½“ç‰¹å¾æ•ˆæœå¹³å‡ä¸€äº›ï¼Œä¸€èˆ¬ä¼šæ¯”reg_alphaçš„æ•°å€¼ç•¥å¤§ä¸€äº›ï¼Œä½†å¦‚æœè¿™ä¸ªå‚æ•°å¤§çš„å¤¸å¼ ä¹Ÿéœ€è¦å†æŸ¥çœ‹ä¸€éç‰¹å¾æ˜¯å¦åˆç† ä»£ç å®ä¾‹ è®­ç»ƒæ¨¡å‹å¹¶æ±‚æœ€ä¼˜å‚æ•°çš„å‡½æ•°å®šä¹‰ import lightgbm as lgb def cv_model(clf, train_x, train_y, test_x, clf_name): åˆ’åˆ†100æŠ˜å¹¶è¿›è¡Œæ•°æ®æ‰“ä¹±\nfolds = 10 seed = 2022 kf = KFold(n_splits=folds, shuffle=True, random_state=seed) â€‹ è®¾ç½®æµ‹è¯•é›†çš„è¾“å‡ºçŸ©é˜µã€‚æ¯ä¸€ç»„æ•°æ®è¾“å‡ºï¼š[0,0,0,0]ä»¥æ¦‚ç‡å€¼å¡«å…¥\ntest = np.zeros((test_x.shape[0],4)) #äº¤å‰éªŒè¯åˆ†æ•° cv_scores = [] onehot_encoder = OneHotEncoder(sparse=False) æ ¹æ®æŠ˜æ•°è¿›è¡Œåˆ’åˆ†ï¼Œiå€¼ä»£è¡¨ç¬¬ï¼ˆi+1ï¼‰æŠ˜ã€‚æ¯ä¸€ä¸ªKæŠ˜éƒ½è¿›è¡Œã€Œæ•°æ®æ··ä¹±ï¼šéšæœºã€æ“ä½œ train_indexï¼š10æŠ˜é‡Œ9æŠ˜åœ¨train_index valid_indexï¼šå‰©ä¸‹1æŠ˜æ ·æœ¬ç´¢å¼•å€¼ï¼Œä½œä¸ºéªŒè¯é›†ç”¨äºç»™å‡ºã€Œè®­ç»ƒè¯¯å·®ã€\nfor i, (train_index, valid_index) in enumerate(kf.split(train_x, train_y)): if i \u003c 9: #æ‰“å°ç¬¬ï¼ˆi+1ï¼‰ä¸ªæ¨¡å‹ç»“æœ print('æ¨¡å‹:'i+1) #å°†è®­ç»ƒé›†åˆ†ä¸ºï¼šçœŸæ­£è®­ç»ƒçš„æ•°æ®ï¼ˆK-1æŠ˜ï¼‰ï¼Œå’Œ è®­ç»ƒé›†ä¸­çš„æµ‹è¯•æ•°æ®ï¼ˆ1æŠ˜ï¼‰ trn_x, trn_y, val_x, val_y = train_x.iloc[train_index], train_y.iloc[train_index], train_x.iloc[valid_index], train_y.iloc[valid_index] æ¨¡å‹çš„è®¾ç½®å’Œè°ƒç”¨ #LGBæ¨¡å‹ if clf_name == \"lgb\": #è®­ç»ƒæ ·æœ¬ train_matrix = clf.Dataset(trn_x, label=trn_y) #è®­ç»ƒé›†ä¸­æµ‹è¯•æ ·æœ¬ valid_matrix = clf.Dataset(val_x, label=val_y) #å‚æ•°è®¾ç½® params = { 'boosting_type': 'gbdt', #boostingæ–¹å¼ 'objective': 'multiclass', #ä»»åŠ¡ç±»å‹ä¸ºã€Œå¤šåˆ†ç±»ã€ 'num_class': 4, #ç±»åˆ«ä¸ªæ•° 'num_leaves': 2 ** 5, #æœ€å¤§çš„å¶å­æ•°ï¼Œæ ‘æ¨¡å‹çš„å¤æ‚åº¦ 'feature_fraction': 0.8, #æ¯æ¬¡è¿­ä»£ä¸­éšæœºé€‰æ‹©ç‰¹å¾çš„æ¯”ä¾‹ï¼ˆ0.5-0.9ä¹‹é—´è°ƒæ•´ï¼‰ 'bagging_fraction': 0.8, #ä¸è¿›è¡Œé‡é‡‡æ ·çš„æƒ…å†µä¸‹éšæœºé€‰æ‹©éƒ¨åˆ†æ•°æ®ï¼ˆ0.5-0.9ä¹‹é—´è°ƒæ•´ï¼‰ 'bagging_freq': 5, #æ¯5æ¬¡è¿­ä»£ï¼Œè¿›è¡Œä¸€æ¬¡baggingï¼ˆ3-5ä¹‹é—´è°ƒæ•´ï¼‰ 'learning_rate': 0.05, #å­¦ä¹ ç‡ 'seed': seed, #seedå€¼ï¼Œä¿è¯æ¨¡å‹å¤ç° 'nthread': 28, 'n_jobs':24, #å¤šçº¿ç¨‹ 'verbose': 1, 'lambda_l1': 0.4, # L1æ­£åˆ™åŒ– 'lambda_l2': 0.5, #L2æ­£åˆ™åŒ– 'min_data_in_leaf':100, #å¶å­å¯èƒ½å…·æœ‰çš„æœ€å°è®°å½•æ•° } #æ¨¡å‹ model = clf.train(params, train_set=train_matrix, #è®­ç»ƒæ ·æœ¬ valid_sets=valid_matrix, #æµ‹è¯•æ ·æœ¬ num_boost_round=2000, #è¿­ä»£æ¬¡æ•° verbose_eval=100, early_stopping_rounds=200) #å¦‚æœæ•°æ®åœ¨200æ¬¡å†…æ²¡æœ‰æé«˜ï¼Œåœæ­¢è®¡ç®— â€‹\nval_pred = model.predict(val_x, num_iteration=model.best_iteration) test_pred = model.predict(test_x, num_iteration=model.best_iteration) val_y = np.array(val_y).reshape(-1, 1) val_y = onehot_encoder.fit_transform(val_y) print('é¢„æµ‹çš„æ¦‚ç‡çŸ©é˜µï¼š') print(test_pred) test += test_pred #éªŒè¯é›†è®¡ç®—è®­ç»ƒè¯¯å·® score = loss(val_y, val_pred) cv_scores.append(score) print(cv_scores) print(\"%s_scotrainre_list:\" % clf_name, cv_scores) print(\"%s_score_mean:\" % clf_name, np.mean(cv_scores)) print(\"%s_score_std:\" % clf_name, np.std(cv_scores)) #iä¸ªæ¨¡å‹è¾“å‡ºç»“æœçš„å¹³å‡å€¼ã€‚ test = test / 10 return test è°ƒç”¨æ¨¡å‹çš„å‡½æ•°å®šä¹‰ def lgb_model(x_train, y_train, x_test): lgb_test = cv_model(lgb, x_train, y_train, x_test, \"lgb\") return lgb_test def loss(y_p,y_t): y_p=np.array(y_p) y_t=np.array(y_t) loss=sum(sum(abs(y_p-y_t))) return loss lgb_test = lgb_model(X_train, y_train, X_test) ",
  "wordCount" : "2133",
  "inLanguage": "zh",
  "datePublished": "2022-04-05T22:11:08+08:00",
  "dateModified": "2022-04-05T22:11:08+08:00",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://fishdel.github.io/zh/posts/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0%E5%AE%9E%E6%88%98lightgbm/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Yuuuuu's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://fishdel.github.io/favicon.png"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://fishdel.github.io/zh/" accesskey="h" title="Yuuuuu&#39;s Blog (Alt + H)">Yuuuuu&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://fishdel.github.io/zh/" title="ğŸ ä¸»é¡µ">
                    <span>ğŸ ä¸»é¡µ</span>
                </a>
            </li>
            <li>
                <a href="https://fishdel.github.io/zh/posts/" title="ğŸ“šæ–‡ç« ">
                    <span>ğŸ“šæ–‡ç« </span>
                </a>
            </li>
            <li>
                <a href="https://fishdel.github.io/zh/archives/" title="â±æ—¶é—´è½´">
                    <span>â±æ—¶é—´è½´</span>
                </a>
            </li>
            <li>
                <a href="https://fishdel.github.io/zh/tags/" title="ğŸ”–æ ‡ç­¾">
                    <span>ğŸ”–æ ‡ç­¾</span>
                </a>
            </li>
            <li>
                <a href="https://fishdel.github.io/zh/categories/" title="ğŸ§©åˆ†ç±»">
                    <span>ğŸ§©åˆ†ç±»</span>
                </a>
            </li>
            <li>
                <a href="https://fishdel.github.io/zh/search/" title="ğŸ”æœç´¢">
                    <span>ğŸ”æœç´¢</span>
                </a>
            </li>
            <li>
                <a href="https://fishdel.github.io/zh/about/" title="ğŸ™‹ğŸ»â€â™‚ï¸å…³äº">
                    <span>ğŸ™‹ğŸ»â€â™‚ï¸å…³äº</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    
    <h1 class="post-title entry-hint-parent">
      æœºå™¨å­¦ä¹ å®æˆ˜(LightGBM)
    </h1>
    <div class="post-meta"><span title='2022-04-05 22:11:08 +0800 CST'>å››æœˆ 5, 2022</span>

</div>
  </header> 
  <div class="post-content"><h2 id="lightgbm">LightGBM<a hidden class="anchor" aria-hidden="true" href="#lightgbm">#</a></h2>
<h3 id="ä»‹ç»">ä»‹ç»<a hidden class="anchor" aria-hidden="true" href="#ä»‹ç»">#</a></h3>
<p>LightGBMï¼ˆLight Gradient Boosting Machineï¼‰ï¼šä¸€ä¸ªå®ç°GBDTç®—æ³•çš„æ¡†æ¶ï¼Œè§£å†³GBDTåœ¨æµ·é‡æ•°æ®é‡åˆ°çš„é—®é¢˜ã€‚</p>
<h5 id="ä¸¤å¤§æŠ€æœ¯">ä¸¤å¤§æŠ€æœ¯ï¼š<a hidden class="anchor" aria-hidden="true" href="#ä¸¤å¤§æŠ€æœ¯">#</a></h5>
<p>ï¼ˆ1ï¼‰GOSS(Gradient-based One-Side Sampling)ï¼šå‡å°‘æ ·æœ¬æ•°</p>
<p>ï¼ˆ2ï¼‰EFB (Exclusive Feature Bundling ):å‡å°‘ç‰¹å¾æ•°</p>
<p>XGBoostçš„ç¼ºç‚¹ï¼šå…ˆé¢„æ’åºå†æ‰¾åˆ†å‰²ç‚¹ï¼Œç©ºé—´æ¶ˆè€—å¤§</p>
<p>XGBoostä¸LightGBMçš„åŒºåˆ«ï¼š</p>
<table>
  <thead>
      <tr>
          <th></th>
          <th>lightGBM</th>
          <th>XGBoost</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>åˆ†è£‚æ–¹å¼</td>
          <td>leaft-wiseé€‰æ‹©åˆ†è£‚æ”¶ç›Šæœ€å¤§çš„èŠ‚ç‚¹ï¼Œè¦é™åˆ¶æ·±åº¦å®¹æ˜“è¿‡æ‹Ÿåˆ</td>
          <td>level-wiseæ— å·®åˆ«åˆ†è£‚</td>
      </tr>
      <tr>
          <td>è¾“å…¥</td>
          <td>lightgbmæ”¯æŒç›´æ¥è¾“å…¥categorical çš„feature</td>
          <td>éœ€è¦one-hotç¼–ç </td>
      </tr>
      <tr>
          <td>æ—¶é—´å¤æ‚åº¦</td>
          <td><em>åŸºäºç›´æ–¹å›¾çš„å†³ç­–æ ‘ç®—æ³•ï¼Œç›´æ–¹å›¾çš„ä¼˜åŒ–ç®—æ³•åªéœ€è¦è®¡ç®—Kæ¬¡ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(K</em>feature)</td>
          <td>åŸºäºé¢„æ’åºçš„å†³ç­–æ ‘ç®—æ³•ï¼Œæ¯éå†ä¸€ä¸ªç‰¹å¾å°±éœ€è¦è®¡ç®—ä¸€æ¬¡ç‰¹å¾çš„å¢ç›Šï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(data<em>feature)</em></td>
      </tr>
      <tr>
          <td></td>
          <td>ç‰¹å¾æ†ç»‘è½¬åŒ–ä¸ºå›¾ç€è‰²é—®é¢˜ï¼Œå‡å°‘ç‰¹å¾æ•°é‡</td>
          <td></td>
      </tr>
  </tbody>
</table>
<h3 id="ä¸¤ç§ä½¿ç”¨å½¢å¼">ä¸¤ç§ä½¿ç”¨å½¢å¼<a hidden class="anchor" aria-hidden="true" href="#ä¸¤ç§ä½¿ç”¨å½¢å¼">#</a></h3>
<h4 id="sklearnæ¥å£å½¢å¼">sklearnæ¥å£å½¢å¼<a hidden class="anchor" aria-hidden="true" href="#sklearnæ¥å£å½¢å¼">#</a></h4>
<p>å¯¼åŒ…</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">mean_squared_error</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_boston</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">gbm</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">LGBMRegressor</span><span class="p">(</span><span class="n">objective</span><span class="o">=</span><span class="s1">&#39;regression&#39;</span><span class="p">,</span> <span class="n">num_leaves</span><span class="o">=</span><span class="mi">31</span><span class="p">,</span> <span class="n">learning_rate</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">n_estimators</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">gbm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">eval_set</span><span class="o">=</span><span class="p">[(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">)],</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;l1&#39;</span><span class="p">,</span> <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span></code></pre></div><h4 id="åŸç”Ÿå½¢å¼">åŸç”Ÿå½¢å¼<a hidden class="anchor" aria-hidden="true" href="#åŸç”Ÿå½¢å¼">#</a></h4>
<p>æ•°æ®é›†åˆ‡åˆ†ä¸è½¬æ¢</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">lgb_train</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#If this is Dataset for validation, training data should be used as reference.</span>
</span></span><span class="line"><span class="cl"><span class="n">lgb_eval</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">reference</span><span class="o">=</span><span class="n">lgb_train</span><span class="p">)</span> 
</span></span></code></pre></div><p>å°†å‚æ•°å†™ä¸ºå­—å…¸å½¢å¼</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;task&#39;</span><span class="p">:</span> <span class="s1">&#39;train&#39;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;boosting_type&#39;</span><span class="p">:</span> <span class="s1">&#39;gbdt&#39;</span><span class="p">,</span>  <span class="c1"># è®¾ç½®æå‡ç±»å‹</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;regression&#39;</span><span class="p">,</span>  <span class="c1"># ç›®æ ‡å‡½æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;metric&#39;</span><span class="p">:</span> <span class="p">{</span><span class="s1">&#39;l2&#39;</span><span class="p">,</span> <span class="s1">&#39;auc&#39;</span><span class="p">},</span>  <span class="c1"># è¯„ä¼°å‡½æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;num_leaves&#39;</span><span class="p">:</span> <span class="mi">31</span><span class="p">,</span>  <span class="c1"># å¶å­èŠ‚ç‚¹æ•°</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>  <span class="c1"># å­¦ä¹ é€Ÿç‡</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;feature_fraction&#39;</span><span class="p">:</span> <span class="mf">0.9</span><span class="p">,</span>  <span class="c1"># å»ºæ ‘çš„ç‰¹å¾é€‰æ‹©æ¯”ä¾‹</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;bagging_fraction&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>  <span class="c1"># å»ºæ ‘çš„æ ·æœ¬é‡‡æ ·æ¯”ä¾‹</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;bagging_freq&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>  <span class="c1"># k æ„å‘³ç€æ¯ k æ¬¡è¿­ä»£æ‰§è¡Œbagging</span>
</span></span><span class="line"><span class="cl">    <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">1</span>  <span class="c1"># &lt;0 æ˜¾ç¤ºè‡´å‘½çš„, =0 æ˜¾ç¤ºé”™è¯¯ (è­¦å‘Š), &gt;0 æ˜¾ç¤ºä¿¡æ¯</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>äº¤å‰éªŒè¯ä¸é¢„æµ‹è¯„ä¼°</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">gbm</span> <span class="o">=</span> <span class="n">lgb</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> <span class="n">lgb_train</span><span class="p">,</span> <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">valid_sets</span><span class="o">=</span><span class="n">lgb_eval</span><span class="p">,</span> <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">y_pred</span> <span class="o">=</span> <span class="n">gbm</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">num_iteration</span><span class="o">=</span><span class="n">gbm</span><span class="o">.</span><span class="n">best_iteration</span><span class="p">)</span>
</span></span></code></pre></div><h3 id="epochiterationbatchsizeç›¸å…³ç†è§£">Epochã€Iterationã€Batchsizeç›¸å…³ç†è§£<a hidden class="anchor" aria-hidden="true" href="#epochiterationbatchsizeç›¸å…³ç†è§£">#</a></h3>
<h4 id="epoch">Epoch<a hidden class="anchor" aria-hidden="true" href="#epoch">#</a></h4>
<p>ä¸€ä¸ªå®Œæ•´çš„æ•°æ®é›†é€šè¿‡äº†ç¥ç»ç½‘ç»œä¸€æ¬¡å¹¶ä¸”è¿”å›äº†ä¸€æ¬¡ã€‚æ¢¯åº¦ä¸‹é™çš„æ–¹æ³•æ¥ä¼˜åŒ–å­¦ä¹ è¿‡ç¨‹ï¼Œéšç€epoch</p>
<h4 id="iteration">Iteration<a hidden class="anchor" aria-hidden="true" href="#iteration">#</a></h4>
<p>batchéœ€è¦å®Œæˆä¸€ä¸ªepochçš„æ¬¡æ•°</p>
<p>ä¸€ä¸ªè¿­ä»£=ä¸€ä¸ªæ­£å‘é€šè¿‡+ä¸€ä¸ªåå‘é€šè¿‡ã€‚</p>
<h4 id="batchsize">Batchsize<a hidden class="anchor" aria-hidden="true" href="#batchsize">#</a></h4>
<p>ä¸èƒ½å°†æ•°æ®ä¸€æ¬¡æ€§é€šè¿‡ç¥ç»ç½‘ç»œçš„æ—¶å€™ï¼Œå°±éœ€è¦å°†æ•°æ®é›†åˆ†æˆå‡ ä¸ªbatchã€‚</p>
<p>batchsizeçš„é€‰æ‹©ï¼šBatchï¼šæ•°æ®é›†è¾ƒå°é€‰æ‹©å…¨æ‰¹æ¬¡</p>
<p>mini batchï¼šé€‰å®šåä»¥batchçš„å¤§å°è¾“å…¥ç½‘ç»œï¼Œè®¡ç®—è¿™ä¸ªbatchçš„æ‰€æœ‰æ ·æœ¬çš„å¹³å‡æŸå¤±ï¼Œå³ä»£ä»·å‡½æ•°æ˜¯æ‰€æœ‰æ ·æœ¬çš„å¹³å‡</p>
<p>stochasticï¼šæ¯æ¬¡ä¿®æ­£æ–¹å‘ä»¥å„è‡ªæ ·æœ¬çš„æ¢¯åº¦æ–¹å‘ä¿®æ­£ï¼Œéš¾æ”¶æ•›</p>
<p>å¦‚æœbatchsizeè¿‡å°ï¼Œè®­ç»ƒæ•°æ®éš¾ä»¥æ”¶æ•›å®¹æ˜“æ¬ æ‹Ÿåˆï¼Œå¢åŠ batchsizeç›¸å¯¹å¤„ç†é€Ÿåº¦åŠ å¿«ä½†æ˜¯å ç”¨å†…å­˜å¢åŠ </p>
<h3 id="å‚æ•°è°ƒæ•´">å‚æ•°è°ƒæ•´<a hidden class="anchor" aria-hidden="true" href="#å‚æ•°è°ƒæ•´">#</a></h3>
<table>
  <thead>
      <tr>
          <th>é¢„å…ˆå›ºå®šçš„å‚æ•°</th>
          <th>è°ƒæ•´ç­–ç•¥</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>learning_rate</td>
          <td>0.05~0.1 å­¦ä¹ ç‡è¾ƒå°æ¯”è¾ƒç¨³å®šã€‚é»˜è®¤0.1</td>
      </tr>
      <tr>
          <td>n_estimators</td>
          <td>100~1000ã€‚å¯ä»¥è®¾ç½®ä¸€ä¸ªè¾ƒå¤§çš„å€¼é…åˆearly_stopping_roundæ¥è®©æ¨¡å‹æ ¹æ®æ€§èƒ½è‡ªåŠ¨é€‰æ‹©æœ€å¥½çš„è¿­ä»£æ¬¡æ•°ã€‚é»˜è®¤100</td>
      </tr>
      <tr>
          <td>min_split_gain</td>
          <td>æ‰§è¡ŒèŠ‚ç‚¹åˆ†è£‚çš„æœ€å°å¢ç›Šã€‚é»˜è®¤ä¸º0ã€‚<strong>ä¸å»ºè®®å»è°ƒæ•´</strong>ã€‚å¢å¤§è¿™ä¸ªæ•°å€¼ä¼šå¾—åˆ°ç›¸å¯¹æµ…çš„æ ‘æ·±ã€‚å¯è°ƒæ•´å…¶ä»–å‚æ•°å¾—åˆ°ç±»ä¼¼æ•ˆæœã€‚</td>
      </tr>
      <tr>
          <td>min_child_sample</td>
          <td>ä¸€ä¸ªå¶å­ä¸Šçš„æœ€å°æ•°æ®é‡ã€‚é»˜è®¤è®¾ç½®ä¸º20.æ•°æ®é‡å¤§é€‚å½“å¢åŠ </td>
      </tr>
      <tr>
          <td>min_child_weight</td>
          <td>ä¸€ä¸ªå¶å­ä¸Šçš„æœ€å°hessianå’Œã€‚é»˜è®¤è®¾ç½®ä¸º0.001ï¼Œä¸€èˆ¬è®¾ç½®ä¸º1ã€‚<strong>ä¸å»ºè®®è°ƒæ•´</strong>ï¼Œå¢å¤§æ•°å€¼ä¼šå¾—åˆ°è¾ƒæµ…çš„æ ‘æ·±</td>
      </tr>
  </tbody>
</table>
<table>
  <thead>
      <tr>
          <th>é€šè¿‡ç®—æ³•æ¥æœç´¢çš„å‚æ•°</th>
          <th>è°ƒæ•´ç­–ç•¥</th>
      </tr>
  </thead>
  <tbody>
      <tr>
          <td>max_depth</td>
          <td>3ï¼Œ4ï¼Œ5ï¼ˆè¿‡å¤§å®¹æ˜“è¿‡æ‹Ÿåˆï¼‰</td>
      </tr>
      <tr>
          <td>num_leaves</td>
          <td>å°äº2^max_depth-1</td>
      </tr>
      <tr>
          <td>subsample</td>
          <td>å¤§è‡´çš„æœç´¢èŒƒå›´[0.8, 0.9, 1.0]</td>
      </tr>
      <tr>
          <td>colsample_bytree</td>
          <td>å¤§è‡´çš„æœç´¢èŒƒå›´[0.8, 0.9, 1.0]</td>
      </tr>
      <tr>
          <td>reg_alpha</td>
          <td>æœåŠ¡äºL1æ­£åˆ™åŒ–ï¼Œä¸€èˆ¬å–0-1000çš„èŒƒå›´ã€‚é€šè¿‡ç‰¹å¾ç­›é€‰è¯¥æ•°å€¼ç”±å¤§å˜å°å¯ä»¥å¢åŠ æ¨¡å‹ä¿¡å¿ƒ</td>
      </tr>
      <tr>
          <td>reg_lambda</td>
          <td>æœåŠ¡äºL2æ­£åˆ™åŒ–ï¼Œä¸€èˆ¬0-1000çš„èŒƒå›´ã€‚å¦‚æœæœ‰éå¸¸å¼ºåŠ¿çš„ç‰¹å¾ï¼Œå¯ä»¥äººä¸ºåŠ å¤§ä¸€äº›reg_lambdaä½¿å¾—æ•´ä½“ç‰¹å¾æ•ˆæœå¹³å‡ä¸€äº›ï¼Œä¸€èˆ¬ä¼šæ¯”reg_alphaçš„æ•°å€¼ç•¥å¤§ä¸€äº›ï¼Œä½†å¦‚æœè¿™ä¸ªå‚æ•°å¤§çš„å¤¸å¼ ä¹Ÿéœ€è¦å†æŸ¥çœ‹ä¸€éç‰¹å¾æ˜¯å¦åˆç†</td>
      </tr>
  </tbody>
</table>
<h3 id="ä»£ç å®ä¾‹">ä»£ç å®ä¾‹<a hidden class="anchor" aria-hidden="true" href="#ä»£ç å®ä¾‹">#</a></h3>
<h4 id="è®­ç»ƒæ¨¡å‹å¹¶æ±‚æœ€ä¼˜å‚æ•°çš„å‡½æ•°å®šä¹‰">è®­ç»ƒæ¨¡å‹å¹¶æ±‚æœ€ä¼˜å‚æ•°çš„å‡½æ•°å®šä¹‰<a hidden class="anchor" aria-hidden="true" href="#è®­ç»ƒæ¨¡å‹å¹¶æ±‚æœ€ä¼˜å‚æ•°çš„å‡½æ•°å®šä¹‰">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">lightgbm</span> <span class="k">as</span> <span class="nn">lgb</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cv_model</span><span class="p">(</span><span class="n">clf</span><span class="p">,</span> <span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">,</span> <span class="n">test_x</span><span class="p">,</span> <span class="n">clf_name</span><span class="p">):</span>
</span></span></code></pre></div><p>åˆ’åˆ†100æŠ˜å¹¶è¿›è¡Œæ•°æ®æ‰“ä¹±</p>
<pre tabindex="0"><code>folds = 10
seed = 2022
kf = KFold(n_splits=folds, shuffle=True, random_state=seed)
</code></pre><p>â€‹    è®¾ç½®æµ‹è¯•é›†çš„è¾“å‡ºçŸ©é˜µã€‚æ¯ä¸€ç»„æ•°æ®è¾“å‡ºï¼š[0,0,0,0]ä»¥æ¦‚ç‡å€¼å¡«å…¥</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">test</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">test_x</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">4</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">#äº¤å‰éªŒè¯åˆ†æ•°</span>
</span></span><span class="line"><span class="cl"><span class="n">cv_scores</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl"><span class="n">onehot_encoder</span> <span class="o">=</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">sparse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span></span></code></pre></div><p>æ ¹æ®æŠ˜æ•°è¿›è¡Œåˆ’åˆ†ï¼Œiå€¼ä»£è¡¨ç¬¬ï¼ˆi+1ï¼‰æŠ˜ã€‚æ¯ä¸€ä¸ªKæŠ˜éƒ½è¿›è¡Œã€Œæ•°æ®æ··ä¹±ï¼šéšæœºã€æ“ä½œ
train_indexï¼š10æŠ˜é‡Œ9æŠ˜åœ¨train_index
valid_indexï¼šå‰©ä¸‹1æŠ˜æ ·æœ¬ç´¢å¼•å€¼ï¼Œä½œä¸ºéªŒè¯é›†ç”¨äºç»™å‡ºã€Œè®­ç»ƒè¯¯å·®ã€</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="p">(</span><span class="n">train_index</span><span class="p">,</span> <span class="n">valid_index</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">kf</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">train_x</span><span class="p">,</span> <span class="n">train_y</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">9</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1">#æ‰“å°ç¬¬ï¼ˆi+1ï¼‰ä¸ªæ¨¡å‹ç»“æœ</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;æ¨¡å‹:&#39;</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="c1">#å°†è®­ç»ƒé›†åˆ†ä¸ºï¼šçœŸæ­£è®­ç»ƒçš„æ•°æ®ï¼ˆK-1æŠ˜ï¼‰ï¼Œå’Œ è®­ç»ƒé›†ä¸­çš„æµ‹è¯•æ•°æ®ï¼ˆ1æŠ˜ï¼‰</span>
</span></span><span class="line"><span class="cl">    <span class="n">trn_x</span><span class="p">,</span> <span class="n">trn_y</span><span class="p">,</span> <span class="n">val_x</span><span class="p">,</span> <span class="n">val_y</span> <span class="o">=</span> <span class="n">train_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">train_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">train_index</span><span class="p">],</span> <span class="n">train_x</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">valid_index</span><span class="p">],</span> <span class="n">train_y</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">valid_index</span><span class="p">]</span>
</span></span></code></pre></div><h4 id="æ¨¡å‹çš„è®¾ç½®å’Œè°ƒç”¨">æ¨¡å‹çš„è®¾ç½®å’Œè°ƒç”¨<a hidden class="anchor" aria-hidden="true" href="#æ¨¡å‹çš„è®¾ç½®å’Œè°ƒç”¨">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"> <span class="c1">#LGBæ¨¡å‹</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">clf_name</span> <span class="o">==</span> <span class="s2">&#34;lgb&#34;</span><span class="p">:</span>            
</span></span><span class="line"><span class="cl">            <span class="c1">#è®­ç»ƒæ ·æœ¬</span>
</span></span><span class="line"><span class="cl">            <span class="n">train_matrix</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">trn_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">trn_y</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="c1">#è®­ç»ƒé›†ä¸­æµ‹è¯•æ ·æœ¬</span>
</span></span><span class="line"><span class="cl">            <span class="n">valid_matrix</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">val_x</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="n">val_y</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">            <span class="c1">#å‚æ•°è®¾ç½®</span>
</span></span><span class="line"><span class="cl">            <span class="n">params</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;boosting_type&#39;</span><span class="p">:</span> <span class="s1">&#39;gbdt&#39;</span><span class="p">,</span>          <span class="c1">#boostingæ–¹å¼</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;objective&#39;</span><span class="p">:</span> <span class="s1">&#39;multiclass&#39;</span><span class="p">,</span>        <span class="c1">#ä»»åŠ¡ç±»å‹ä¸ºã€Œå¤šåˆ†ç±»ã€</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;num_class&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span>                   <span class="c1">#ç±»åˆ«ä¸ªæ•°</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;num_leaves&#39;</span><span class="p">:</span> <span class="mi">2</span> <span class="o">**</span> <span class="mi">5</span><span class="p">,</span>             <span class="c1">#æœ€å¤§çš„å¶å­æ•°ï¼Œæ ‘æ¨¡å‹çš„å¤æ‚åº¦</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;feature_fraction&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>          <span class="c1">#æ¯æ¬¡è¿­ä»£ä¸­éšæœºé€‰æ‹©ç‰¹å¾çš„æ¯”ä¾‹ï¼ˆ0.5-0.9ä¹‹é—´è°ƒæ•´ï¼‰</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;bagging_fraction&#39;</span><span class="p">:</span> <span class="mf">0.8</span><span class="p">,</span>          <span class="c1">#ä¸è¿›è¡Œé‡é‡‡æ ·çš„æƒ…å†µä¸‹éšæœºé€‰æ‹©éƒ¨åˆ†æ•°æ®ï¼ˆ0.5-0.9ä¹‹é—´è°ƒæ•´ï¼‰</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;bagging_freq&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">,</span>                <span class="c1">#æ¯5æ¬¡è¿­ä»£ï¼Œè¿›è¡Œä¸€æ¬¡baggingï¼ˆ3-5ä¹‹é—´è°ƒæ•´ï¼‰</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;learning_rate&#39;</span><span class="p">:</span> <span class="mf">0.05</span><span class="p">,</span>            <span class="c1">#å­¦ä¹ ç‡</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;seed&#39;</span><span class="p">:</span> <span class="n">seed</span><span class="p">,</span>                     <span class="c1">#seedå€¼ï¼Œä¿è¯æ¨¡å‹å¤ç°</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;nthread&#39;</span><span class="p">:</span> <span class="mi">28</span><span class="p">,</span>                    
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;n_jobs&#39;</span><span class="p">:</span><span class="mi">24</span><span class="p">,</span>                      <span class="c1">#å¤šçº¿ç¨‹</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;verbose&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;lambda_l1&#39;</span><span class="p">:</span> <span class="mf">0.4</span><span class="p">,</span>                 <span class="c1"># L1æ­£åˆ™åŒ–</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;lambda_l2&#39;</span><span class="p">:</span> <span class="mf">0.5</span><span class="p">,</span>                 <span class="c1">#L2æ­£åˆ™åŒ–</span>
</span></span><span class="line"><span class="cl">                <span class="s1">&#39;min_data_in_leaf&#39;</span><span class="p">:</span><span class="mi">100</span><span class="p">,</span>           <span class="c1">#å¶å­å¯èƒ½å…·æœ‰çš„æœ€å°è®°å½•æ•°</span>
</span></span><span class="line"><span class="cl">            <span class="p">}</span>
</span></span><span class="line"><span class="cl">            
</span></span><span class="line"><span class="cl">            <span class="c1">#æ¨¡å‹</span>
</span></span><span class="line"><span class="cl">            <span class="n">model</span> <span class="o">=</span> <span class="n">clf</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">params</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">                      <span class="n">train_set</span><span class="o">=</span><span class="n">train_matrix</span><span class="p">,</span>     <span class="c1">#è®­ç»ƒæ ·æœ¬</span>
</span></span><span class="line"><span class="cl">                      <span class="n">valid_sets</span><span class="o">=</span><span class="n">valid_matrix</span><span class="p">,</span>    <span class="c1">#æµ‹è¯•æ ·æœ¬ </span>
</span></span><span class="line"><span class="cl">                      <span class="n">num_boost_round</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span>      <span class="c1">#è¿­ä»£æ¬¡æ•°</span>
</span></span><span class="line"><span class="cl">                      <span class="n">verbose_eval</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>           
</span></span><span class="line"><span class="cl">                      <span class="n">early_stopping_rounds</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>  <span class="c1">#å¦‚æœæ•°æ®åœ¨200æ¬¡å†…æ²¡æœ‰æé«˜ï¼Œåœæ­¢è®¡ç®—</span>
</span></span></code></pre></div><p>â€‹</p>
<pre tabindex="0"><code class="language-python'" data-lang="python'">            val_pred = model.predict(val_x, num_iteration=model.best_iteration)
            test_pred = model.predict(test_x, num_iteration=model.best_iteration) 

        val_y = np.array(val_y).reshape(-1, 1)
        val_y = onehot_encoder.fit_transform(val_y)
        print(&#39;é¢„æµ‹çš„æ¦‚ç‡çŸ©é˜µï¼š&#39;)
        print(test_pred)
        test += test_pred
        #éªŒè¯é›†è®¡ç®—è®­ç»ƒè¯¯å·®
        score = loss(val_y, val_pred)
        cv_scores.append(score)
        print(cv_scores)
    
print(&#34;%s_scotrainre_list:&#34; % clf_name, cv_scores)
print(&#34;%s_score_mean:&#34; % clf_name, np.mean(cv_scores))
print(&#34;%s_score_std:&#34; % clf_name, np.std(cv_scores))

#iä¸ªæ¨¡å‹è¾“å‡ºç»“æœçš„å¹³å‡å€¼ã€‚
test = test / 10
return test
</code></pre><h4 id="è°ƒç”¨æ¨¡å‹çš„å‡½æ•°å®šä¹‰">è°ƒç”¨æ¨¡å‹çš„å‡½æ•°å®šä¹‰<a hidden class="anchor" aria-hidden="true" href="#è°ƒç”¨æ¨¡å‹çš„å‡½æ•°å®šä¹‰">#</a></h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">lgb_model</span><span class="p">(</span><span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">lgb_test</span> <span class="o">=</span> <span class="n">cv_model</span><span class="p">(</span><span class="n">lgb</span><span class="p">,</span> <span class="n">x_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">x_test</span><span class="p">,</span> <span class="s2">&#34;lgb&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">lgb_test</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">loss</span><span class="p">(</span><span class="n">y_p</span><span class="p">,</span><span class="n">y_t</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">	<span class="n">y_p</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_p</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">y_t</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y_t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">loss</span><span class="o">=</span><span class="nb">sum</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">y_p</span><span class="o">-</span><span class="n">y_t</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">loss</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="n">lgb_test</span> <span class="o">=</span> <span class="n">lgb_model</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">)</span>
</span></span></code></pre></div>

  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://fishdel.github.io/zh/tags/machine-learning/">Machine Learning</a></li>
    </ul>
  </footer>
</article>
    </main>
    
<footer class="footer">
        <span><a href="https://fishdel.github.io/">Â©2024 Yuuuu&rsquo;s Blog</a></span> Â· 

    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
